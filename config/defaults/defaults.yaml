# Default configuration settings for merging
# Please create your own config files instead of modifying this one directly!

inputs:
    mode: dids              # Options: query, dids, files
    namespace: "usertests"  # Default namespace for local input files
    inputs: []              # List of inputs
    search_dirs: []         # List of directories to search for metadata files

output:
    scripts: "tmp"    # Directory for generated job scripts (relative to package dir)
    mode: justin      # Options: dids, replicas, pfns, local, justin
    dir: "/pnfs/dune/scratch/users/${USER}/merge_test" # Directory for output merged files
    namespace: "usertests" # Optionally specify a namespace different from the parents
    name: "{core.run_type}_{dune.campaign}_{dune.config_file}_{core.application.name}"
    #name: "{core.run_type}_{core.file_type}_{dune.campaign}_{core.data_stream}_{dune.config_file}_{core.data_tier}"
    grandparents: False # List the parents of the input files as the parents of the merged file

validation:
    batch_size: 100   # Number of files to query metacat about at once
    fast_fail: True   # Stop processing files as soon as one batch fails validation
    skip:             # Continue processing files even if some fail validation
        missing:      False # Skip files with missing metadata
        duplicate:    False # Skip duplicated files
        unreachable:  False # Skip files that are not accessible
        invalid:      False # Skip files with invalid metadata
        inconsistent: False # Skip files with inconsistent metadata
    checksums:
      - "adler32"     # Adler32 should be the default checksum
    optional:         # These metadata keys are optional (overrides required and conditional keys)
      - "dune_mc.geometry_version"
      - "dune_mc.gen_fcl_filename"

sites:
    justin_url: "https://justin-ui-fnal.dune.hep.ac.uk"
    local_site: "US_FNAL-FermiGrid"   # Local site name
    allowed_sites:                    # Sites where merging is allowed
      - "US_FNAL-FermiGrid"
      - "CERN"
    max_distance: 1000                # Distances range from 0 to 101
    nearline_distance:                # Extra distance to account for staging
        default:        100           # Default distance for all RSEs
        "FNAL_DCACHE":  10
    streaming: True                   # Stream files from remote sites instead of making a local copy

merging:
    target_mode: size   # Options: size, count
    target_size: 10     # Target size (in GB) or number of files
    equalize: True      # Try to equalize the size of the merged files
    chunk_min: 2        # Minimum number of files to merge at once
    chunk_max: 100      # Maxiumum number of files to merge at once
    method: auto        # Can be auto or a specific method from the list below
    methods:
        "hadd":
            file_format:
              - "root"
              - "rootntuple"
              - "tfile"
            ext: ".root"
        "lar":
            file_format:
              - "artroot"
            ext: ".root"
            cfg: "artcat.fcl"
        "hdf5":
            file_format:
              - "hdf5"
            ext: ".hdf5"
            cfg: "hdf5.yaml"
        "tar":
            file_format:
              - "binary"
              - "tar"
              - "unknown"
            output_format: "tar"
            ext: ".tar"
    
